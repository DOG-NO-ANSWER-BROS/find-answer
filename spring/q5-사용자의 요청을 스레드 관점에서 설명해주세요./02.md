## 스레드

- 애플리케이션 코드를 순차적으로 실행하는 것
- 자바 메인 메서드를 실행하면 main 이라는 이름의 스레드가 생성
- 스레드가 없다면 자바 에플리케이션 실행이 불가
- 스레드는 한번에 하나의 코드라인만 수행
- 동시 처리가 필요하면 스레드를 추가 생성

## 단일 요청 - 스레드 하나 사용
![image](https://user-images.githubusercontent.com/63634505/121028238-9cac3580-c7e2-11eb-8996-1b0d563c48e6.png)

## 다중 요청 - 스레드 하나 사용

![image](https://user-images.githubusercontent.com/63634505/121028361-b9e10400-c7e2-11eb-8da4-99c180f5d40d.png)

## 다중 요청 - 요청마다 스레드 생성

![image](https://user-images.githubusercontent.com/63634505/121028506-dc731d00-c7e2-11eb-8e92-b4092c7aa738.png)

## 요청 마다 스레드 생성 장단점

장점

- 동시 요청을 처리할 수 있다
- 리소스가 허용할 때까지 처리 가능
- 스레드가 지연되어도 나머지 스레드는 정상 동작

단점

- 스레드의 생성비용
- 스레드는 컨텍스트 스위칭 비용이 발생
- 스레드 생성에 제한이 없다 → 많은 요청이 오면 cpu, 메모리가 임계점을 넘어 서버가 죽을 수 있다

## 스레드 풀

![image](https://user-images.githubusercontent.com/63634505/121028735-04fb1700-c7e3-11eb-8b18-bc52aebdd9a2.png)

## 요청 마다 스레드 생성의 단점 보완

특징

- 필요한 스레드를 스레드 풀에 보관하고 관리
- 생성 가능한 스레드의 최대치를 관리한다. tomcat 은 200개 기본 설정

사용

- 스레드가 필요하면, 이미 생성되어 있는 스레드를 스레드 풀에서 꺼내 사용
- 사용 종료시 스레드 풀에 반납
- 스레드 풀에 스레드가 없다면 요청을 거절하거나 특정 숫자만큼 대기하도록 설정 할 수 있다

장점

- 스레드가 미리 생성되어 있어 비용절약 및 시간이 빠름
- 최대치가 있어서 많은 요청이 들어와도 안전하게 처리 가능

## 질문
**스레드, 스레드 풀의 적정 숫자는 어떻게 찾나?**

`적정 스레드 개수 = cpu 수 * (1+ 대기, 유휴 시간/서비스 시간)`

- CPU 대기시간이 서비스 시간보다 짧다면 CPU 개수보다 스레드가 적어야 성능이 좋다.
- 대기시간이 서비스 처리 시간 보다 많다면 스레드 수는 cpu 개수보다 많아야 성능이 좋다.

`적정 스레드 풀 개수 = CPU 수 * (CPU 목표 사용량) * (1+대기 시간/서비스 시간)`
- TTP 응답 시에는 JMS(자바 메시지 서비스) 로부터의 요청, JDBC Connection Pool과 같은 애플리케이션의 영역을 고려하자면, CPU 사용량을 추가하면 된다. 이때 CPU 목표 사용량은 0~1 사이다.

