# 교착상태, 즉 Deadlock 의 네 가지 조건

## 교착상태란?
* 교착 상태란 두 개 이상의 작업이 서로 상대방의 작업이 끝나기 만을 기다리고 있는 상황을 말한다.
* 둘 다 기다리기 때문에 결국 완료되는 것이 없다!
* 두 사람이 요리를 한 주방에서 하다가 서로 상대방이 사용하는 전자레인지나 가스레인지를 필요로 하는 상황에 요리가 진행이 안되는 모습을 상상하면 좋다.

<img width="779" alt="Screen Shot 2021-11-05 at 8 39 15 AM" src="https://user-images.githubusercontent.com/48251668/140434891-e2d3e2a3-63a5-436e-9a0a-c8212eb11fef.png">

## 교착상태의 네 가지 조건
* 교착상태는 네 가지 조건 중에서 한 가지라도 만족하지 않으면 발생하지 않는다.
* 그리고 네 가지 조건이 독립적이지 않다. 예를 들어 이중 순환대기 조건은 점유대기 조건과 비선점 조건을 만족해야 성립한다.

### 1. 상호배제 (mutual exclusion)
**프로세스들이 필요로 하는 자원에 대해 배타적인 통제권을 요구한다.**
### 2. 점유대기 (hold and wait)
**프로세스가 할당된 자원을 가진 상태에서 다른 자원을 기다린다.**
### 3. 비선점 (no preemption)
**프로세스가 어떤 자원의 사용을 끝낼 때까지 그 자원을 뺏을 수 없다**
### 4. 순환대기 (circular wait)
**각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있다.**

## 예방하는 방법
* 현재 이 방법을 해결하는 일반적인 방법은 아직 없는 상태다.
* 따라서 교착 상태가 발생한 경우, 여러 운영체제들은 제각기 다른 **비표준** 방식으로 대응한다.
* 그런데 이런 방법들은 자원 사용의 효율성이 떨어지고 비용이 많이 든다.

주요 접근 방식은 다음과 같다:

### 상호배제 조건의 제거
* 교착상태라는 것이 두 개 이상의 프로세스가 자원을 동시에 사용 할 때 발생하는 것이므로, 둘 다 해당 자원을 사용하지 못 하도록 하면 된다.
### 점유와 대기 조건의 제거
* 한 프로세스에게 요구한 자원을 전부 할당한다. 하나라도 부족하면 전부 할당하지 않는다.
* 그리고 다음 프로세스는 그 자원을 요청하도록 한다. 이 쪽도 그 자원을 모두 할당 받거나 모두 할당 받지 않는다.
* 자원을 과다하게 사용하기 때문에 효율성 문제가 발생한다.
* 프로세스가 요구하는 자원을 파악하는 데 비용이 든다.
* 자원에 대한 내용을 저장하고 복원하기 위한 비용이 든다.
* 프로세스가 자원을 할당받지 못하는 기아 상태 상황이 발생한다.
### 비선점 조건의 제거
* 선점이 가능하도록 프로토콜을 제공한다.
* 즉, 앞서 말한 주방 예시에서 주방제품을 먼저 사용하겠다고 상대방에게 알리는 것이다.
### 순환대기 조건의 제거
* 자원 유형에 따라 순서를 매긴다.

## 교착 상태의 회피, 무시, 발견
### 회피
* 자원 할당 상태를 검사하여 자원이 어떻게 요청될지에 대한 추가정보를 제공하도록 한다.
### 무시
* 별다른 조치를 취하지 않는다...
* 예방 혹은 회피기법을 넣었다가 성능에 큰 영향을 끼칠 수 있다는 것인데, 무시하는 것 역시 무한 대기 상황이 발생해서 좋은 방법은 아니라는 생각이 든다.
### 발견
* detection 알고리즘을 사용하여 deadlock 이 발생했는지 확인한다.
* 이 역시 성능에 큰 영향을 끼칠 수 있다고 한다.

## 질문
### 교착 상태를 발견하는 detection 알고리즘으로 무엇이 있을까?
* 자원 할당 그래프 알고리즘 (Resource Allocation Graph Algorithm)
* 은행원 알고리즘 (Banker's Algorithm)

* 은행원 알고리즘에서 운영체제는 안전상태를 유지할 수 있는 요구만 수락하고, 불안전 상태를 초래할 사용자의 요구는 나중에 만족될 수 있을 때까지 계속 거절한다. 즉, 교착 상태를 예측하여 그것이 가능한 상태는 자원을 할당하지 않는 것이다.

## 참고
* https://ko.wikipedia.org/wiki/%EA%B5%90%EC%B0%A9_%EC%83%81%ED%83%9C
