# TCP 연결 과정

#### 다시, 빠르게 OSI 7계층
1. 응용 계층, 2. 표현 계층, 3. 세션 계층, 4. **전송 계층**, 5. 네트워크 계층, 6. 데이터링크 계층, 7. 물리 계층

## TCP, 전송 제어 프로토콜 (Transmission Control Protocol)
* IP와 함께 TCP/IP라는 명칭으로도 불린다.
* 전송 계층에 위치한다.
* 키워드 : **안전성**.
* 설명 : 일련의 옥텟(8byte)을 안정적으로, 순서대로, 에러없이 교환할 수 있게 한다.
* 안전성이 필요없다면? **오버헤드가 작고 지연시간이 짧은 게 좋다** -> [UDP(사용자 데이터그램 프로토콜)](https://ko.wikipedia.org/wiki/%EC%82%AC%EC%9A%A9%EC%9E%90_%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B7%B8%EB%9E%A8_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C)

## '안전성'이 뭘까?
앞서 말했듯, TCP는 네트워크 상에서 정보를
1. 안정적으로 : 메시지 수신을 확인한다.
2. 순서대로 : 메시지 순서를 보장하기 위해 재조립한다.
3. 에러 없이 : 패킷 누락이 되면 재전송한다.

## TCP 세그먼트
1. 데이터 스트림으로부터 데이터 받아 들인다. -> 청크 단위 분할
2. TCP 헤더 덧붙여 TCP 세그먼트 생성
3. IP 데이터그램에 캡슐화되어 주고 받음

### TCP 헤더의 구조
TCP 헤더는 10개의 필수 필드 및 옵션 확장 필드들을 포함한다.
다 기억할 필요는 없고, 다음과 같은 키 요소들이 있다:

**키 포인트**
1. 송신 포트 번호
2. 수신 포트 번호
3. TCP Flags - 연결 확립에 필요하다.

### TCP Flag?
* URG - 긴급! (urgent)
* ACK - 요청에 대한 확인 응답! (acknkowledgment)
* PSH - 데이터 즉시 통과 (push)
* RST - 강제 종료 (reset)
* SYN - 클라이언트, 서버의 일련번호 확인 (synchronize)
* FIN - TCP 연결 종료. 더 이상 보낸 데이터 없음을 표시 (finish)

## 프로토콜의 작동
쉽게 생각하자. **연결 - 전달 - 연결 종료** 다.

### 1️⃣ 연결 생성 - 3방향 핸드셰이크
* SYN : 클라이언트가 서버와 통신 가능한지 확인
* SYN-ACK : 응답 가능할 경우 서버가 응답
* ACK : 클라이언트가 서버에게 데이터 전송을 시작하겠다고 알림
### 2️⃣ 데이터 전송

### 3️⃣ 연결 종료 - 4방향 핸드셰이크
* FIN-ACK : 클라이언트가 연결 종료하겠다는 FIN 플래그 전송
* ACK : 서버 확인 메시지 전송, 그리고 자신의 통신 끝날 때까지 기다림
* FIN-ACK : 서버가 통신이 끝났다고 다시 전송
* ACK : 클라이언트 확인 응답

## 질문
**RFC란 뭘까?**
네트워크, 아니 전체적인 CS 관련 내용을 보면 rfc 문서를 많이 접한다. 이런 문서를 보면 쫄아야할까? 아니면 뭔지 알아야할까?
당연히 알면 좋으니 한 번 보도록 한다.

* WHAT: Request for Comments, 즉 비평을 기다리는 문서
* WHO: [ISOC](https://en.wikipedia.org/wiki/Internet_Society)가 출간. 기술자 및 과학자들이 작성.
* 일련 번호가 부여된다 ex: [rfc-675](https://datatracker.ietf.org/doc/html/rfc675)
* **폐지되지 않는다** 수정이 필요하면 다른 rfc를 출간하여 이전 버전을 무효화함을 명시한다 (위의 rfc-675도 들어가보면 rfc-7805 때문에 무효화 됨)
* 그래서 자연스럽게 rfc는 인터넷의 역사가 된다.
* **IETF가 인터넷 표준으로 받아들이는 rfc도 있다.** 즉, 꼭 표준이 아닌 것들도 많다. 애초에 '비평을 기다리는 문서'.
