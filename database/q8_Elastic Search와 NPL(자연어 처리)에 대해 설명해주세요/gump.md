> Elastic Search는 Apache Lucene 라이브러리를 기반으로 하는 Java 오픈소스 분산 검색 엔진이에요.
> 

실시간, 분산형 분석엔진이라고도 불려요. 

테이블과 스키마 대신에 문서 구조로된 데이터를 사용해요. 

ElasticSearch는 검색을 위해 단독으로 사용되거나, ELK(Elasticsearch / Logstatsh / Kibana ) 스택으로 사용되기도 합니다. 

- **Elasticsearch**
    - Logstash로부터 받은 데이터를 검색 및 집계를 하여 필요한 관심 있는 정보를 획득
- **Logstash**
    - 다양한 소스( DB, csv파일 등 )의 로그 또는 트랜잭션 데이터를 수집, 집계, 파싱하여 Elasticsearch로 전달
- **Kibana**
    - Elasticsearch의 빠른 검색을 통해 데이터를 시각화 및 모니터링

![https://user-images.githubusercontent.com/48986787/144794873-3bfc53d4-fcf5-40cf-bf62-f1f226ed0b1f.png](https://user-images.githubusercontent.com/48986787/144794873-3bfc53d4-fcf5-40cf-bf62-f1f226ed0b1f.png)

## 엘라스틱 서치

엘라스틱서치는 우리가 가진 데이터 중 특정한 성질을 갖는 데이터를 찾는 것을 도와줘요.
`스토리지`, `색인기`, `검색기`의 기능이 있는데 각각에 대해 알아보죠.

### 스토리지

데이터를 저장할 수 있는 저장소

### 색인(Index)기

수집한 데이터를 색인이라는 과정을 거쳐 검색하기 용이한 데이터로 만들어 주는 역할 
검색 엔진의 색인기의 경우 주로 역색인 방법을 사용

### 검색기

색인된 단어를 검색할 수 있는 검색기에요. 검색기는 검색순위 알고리즘을 가지고 있어서 더욱 적합한 검색결과라고 생각할 수록 그 결과를 상위에 표시해요. 

### Index란?

데이터가 있는 위치를 특정할 수 있는 정보에요. 
책의 예로 들자면, 책의 목차에 비유할 수 있어요. 

### 역색인이란?

색인의 단점을 개선하기위해 사용해요. 전체 문서를 찾아보지 않고 단어(term)로 인덱싱한 값을 찾아요. 

| TERM | PAGE |
| --- | --- |
| 우형 개발자 | 3, 4 |
| 검프 | 1,3 |
| 정산시스템팀 | 1, 6 |

위와 같이 단어를 기준으로 인덱싱이 되어있을 때, "정산시스템팀 검프"  를 검색한다면, 1번 페이지만 검색해도 되기 때문에 검색속도가 빨라지게 돼요.

이렇게 문장으로 검색하는 것을 `형태소 분석`이라 하는데, 이는 자연어 분석의 첫 단계로, 입력 문자열을 형태소열로 바꾸는 작업이에요. 

### **형태소란?**

형태소는 의미의 최소단위로써, 더 이상 분석 불가능한 가장 작은 의미 요소를 말해요. 문법적 혹은 관계적인 뜻을 나타내는 단어 또는 단어의 부분이에요.
긴 문장을 검색하더라도 이렇게 가장 작은 단위로 나누어진 형태소로 검색을 하게돼요. 

## 엘라스틱 서치 구성요소

### **인덱스(Index)**

하나의 인덱스는 하나의 타입만 가지며 하나의 물리적인 노드에 여러 개의 논리적인 인덱스를 생성할 수 있어요. 
검색 시 인덱스 이름으로 문서 데이터를 검색하며, 여러 개의 인덱스를 동시에 검색하는 것도 가능해요. 

엘라스틱서치를 분산 환경으로 구성하면 하나의 인덱스가 여러 노드에 분산 저장되어 관리돼요. 엘라스틱서치는 인덱스 생성 시 기본적으로 5개의 프라이머리 샤드와 레플리카 샤드 세트를 생성해요. 

인덱스의 이름은 모두  소문자여야 하며 추가, 수정, 삭제, 검색을 REST API로 수행할 수 있어요. 만약 인덱스가 없는 상태에서 데이터가 추가된다면 데이터를 이용해 인덱스가 자동으로 생성돼요. 

### **샤드(Shards)**

색인된 문서는 하나의 인덱스에 담겨요. 인덱스 내부에 색인된 데이터는 물리적인 공간에 여러 개의 파티션으로 나뉘어 구성되는데, 이 파티션을 샤드라 불러요. 다수의 샤드로 문서를 분산저장하고 있어 데이터 손실 위험을 최소화 할 수 있어요. 

### **타입(Type)**

인덱스의 논리적인 구조를 의미하며, 인덱스 속성에 따라 분류하기도 해요.

### **문서(Document)**

데이터가 저장되는 최소 단위에요. 기본적으로 JSON 포맷으로 데이터가 저장돼요. 데이터베이스와 비교하자면 테이블의 행(레코드)가 엘라스틱서치의 문서에 해당한다고 볼 수 있어요. 하나의 문서는 다수의 필드로 구성돼 있는데 각 필드는 데이터의 형태에 따라 용도에 맞는 데이터 타입을 정의해야 해요. 또한 문서안에 문서를 지정하는 것도 가능해요. 

### **필드(Field)**

문서를 구성하기 위한 속성이이에요. 일반적으로 데이터베이스의 칼럼과 비교할 수 있으나 칼럼이 정정(static)인 데이터 타입인 데 반해 필드는 좀 더 동적인 데이터 타입이라 볼 수 있어요. 

### **매핑(Mapping)**

문서의 필드와 필드의 속성을 정의하고 그에 따른 색인 방법을 정의하는 프로세스에요. 인덱스 매핑 정보에는 여러 가지 데이터 타입을 지정할 수 있지만 필드명은 중복해서 사용할 수 없어요. 

### **클러스터(Cluster)**

물리적인 노드 인스턴스들의 모임이라 볼 수 있어요. 
모든 노드의 검색과 색인 작업을 관장하는 논리적인 개념이라고 할 수 있어요. 관계형 데이터베이스의 경우 모든요청을 서버 하나에서 처리해서 결과를 제공하지만 엘라스틱서치의 경우에는 다수의 서버로 분산해서 처리하는 것이 가능하기 때문에 대용량 데이터를 처리할 수 있어요. 

### **마스터 노드(Master Node)**

인덱스를 생성, 삭제하는 등 클러스터와 관련된 전반적인 작업을 담당해요. 따라서 네트워크 속도가 빠르고 지연이 없는 노드를 마스터 노드로 설정해야해요. 다수의 노드를 마스터 노드로 설정할 수 있지만 결과적으로 하나의 노드만이 마스터 노드로 선출되어 동작해요. 

### **데이터 노드**

데이터 노드는 문서가 실제로 저장되는 노드예요. 데이터가 실제로 분산 저장되는 물리적인 공간인 샤드가 배치되는 노드이기도 해요. 색인 작업은 CPU, 메모리, 스토리지 같은 컴퓨팅 리소스를 많이 소모하기 때문에 리소스 모니터링이 필요해요.

### **코디네이팅 노드**

****데이터 노드, 마스터 노드, 인제스트 노드의 역활을 하지 않고, 들어온 요청을 단순히 라운드로빈 방식으로 분산시켜 주는 노드에요..

### **인제스트 노드**

색인에 앞서 데이터를 전처리하기 위한 노드에요. 데이터의 포맷을 변경하기 위해 스크립트로 전처리 파이프라인을 구성하고 실행할 수 있어요.

## 엘라스틱 서치 특징

Elasticsearch는 다음과 같은 특징이 있어요.

- **Scale out**
    - 샤드를 통해 규모가 수평적으로 늘어날 수 있음
- **고가용성**
    - Replica를 통해 데이터의 안정성을 보장
- **Schema Free**
    - Json 문서를 통해 데이터 검색을 수행하므로 스키마 개념이 없음
- **Restful**
    - 데이터 CURD 작업은 HTTP Restful API를 통해 수행

## Refer

[https://victorydntmd.tistory.com/308](https://victorydntmd.tistory.com/308)

[https://m.blog.naver.com/patronymic/221667477015](https://m.blog.naver.com/patronymic/221667477015)